"use strict";(()=>{function h(t,e=()=>`Unexpected state: ${String(t)}`){if(t==null)throw Error(e());return t}function U(t,e,n=()=>`Unexpected type: expected as ${String(e)}, but actual type ${String(t)}`){if(t instanceof e)return t;throw Error(n())}function o(t,e){let n=h(t,()=>"Unexpected argument: id is null"),r=h(document.getElementById(n),()=>`Element not found: #${n}`);return e?U(r,e):r}function x(){return new Promise(t=>requestAnimationFrame(t))}function u(t){console.error("%o",t)}async function m(t){let e=await fetch(t);if(!e.ok)throw Error(`Failed to fetch ${t}: ${e.statusText}`);return await e.json()}var f=class{#e=[][Symbol.iterator]();#t;#n;#r;#a;#s=()=>{this.renderAll().catch(u)};constructor(e,n,r,a=!1){if(!e.contains(n))throw Error("Wrapper element should contain appendee element");n.innerHTML="",this.#t=n,this.#n=e,this.#r=r,this.#a=a}set iterator(e){"next"in e?this.#e=w(e):this.#e=w(e[Symbol.iterator]()),this.#t.innerHTML="",this.#n.removeEventListener("scroll",this.#s),requestAnimationFrame(()=>{this.#n.removeEventListener("scroll",this.#s),this.#a?this.renderAll().catch(u):(this.#n.addEventListener("scroll",this.#s,{once:!0}),this.#i(()=>C(this.#n)).catch(u))})}async renderAll(){await this.#i(()=>!1)}async#i(e){do{let n=this.#e.next();if(p(n))break;let r=new DocumentFragment;n.value.forEach(a=>r.appendChild(this.#r(a))),this.#t.appendChild(r),await x()}while(!e())}};function C(t){return t.clientHeight+100<t.scrollHeight}function w(t,e=10){let n=null,r={next(...a){if(n)return n;let s=Array(e);for(let i=0;i<e;i++){let l=t.next(...a);p(l)?n=l:s[i]=l.value}return{done:!1,value:s}}};return"throw"in t&&(r.throw=a=>{let s=t.throw(a);return p(s)?s:{done:s.done??!1,value:[s.value]}}),"return"in t&&(r.return=a=>{let s=t.return(a);return p(s)?s:{done:s.done??!1,value:[s.value]}}),r}function p(t){return!!t.done}var g=class extends Error{#e;constructor(e){super("Multiple errors occurred"),this.#e=e}get causes(){return this.#e}};var c=class{#e=[];addListener(e){this.#e.push(e)}removeListener(e){let n=this.#e.indexOf(e);n>=0&&this.#e.splice(n,1)}async dispatch(e){let r=(await Promise.allSettled(this.#e.map(a=>a(e)))).flatMap(a=>a.status==="rejected"?[a.reason]:[]);if(r.length===1)throw r[0];if(r.length>1)throw new g(r)}dispatchNoAwait(e){this.dispatch(e).catch(u)}};var k=["english","german","spanish","french","italian","japanese","koreana","polish","brazilian","russian","turkish","schinese","tchinese"],B={en:"english",de:"german",es:"spanish",fr:"french",it:"italian",ja:"japanese",ko:"koreana",pl:"polish",pt:"brazilian",ru:"russian",tr:"turkish","zh-CN":"schinese","zh-TW":"tchinese"},H=["blocks","prefabs","shapes"],d=class t{static DEFAULT_LANGUAGE="english";#e;#t;#n;#r;constructor(e,n){this.#e=e,this.#t=b(n),this.#n=new Map(H.map(r=>[r,this.#i(t.DEFAULT_LANGUAGE,r)])),this.#r=this.#a()}get(e){let n=this.#r.get(e);if(!n)throw new Error(`No labels for ${this.#t}/${e}`);return n}set language(e){e!==this.#t&&(console.log("LabelHolder set language: %s -> %s",this.#t,e),this.#t=e,this.#r=this.#a())}#a(){return new Map(H.map(e=>[e,this.#s(e)]))}async#s(e){let n=this.#n.get(e);if(!n)throw new Error(`No fallback for ${this.#t}/${e}`);return new T(await this.#i(this.#t,e),await n)}async#i(e,n){return new Map(Object.entries(await m(`${this.#e}/${e}/${n}.json`)))}},T=class{#e;#t;constructor(e,n){this.#e=e,this.#t=n}get(e){return this.#e.get(e)??this.#t.get(e)}};function b(t){for(let e of t)for(let[n,r]of Object.entries(B))if(e.startsWith(n))return r;return d.DEFAULT_LANGUAGE}var E=class{#e;#t=new c;#n;constructor(e,n,r){this.#e=e,this.#n=new d(n,r),this.#r(r),this.#e.language.addEventListener("change",()=>{let a=this.#e.language.value;a!==localStorage.getItem("language")&&(localStorage.setItem("language",a),this.holder.language=a,this.#t.dispatchNoAwait({update:{lang:a}}))})}#r(e){let n=new Set(Array.from(this.#e.language.options).map(a=>a.value));for(let a of k){if(n.has(a))continue;let s=document.createElement("option");s.textContent=a,this.#e.language.appendChild(s)}let r=localStorage.getItem("language")??b(e);this.#e.language.value!==r&&(this.#e.language.value=r,requestAnimationFrame(()=>this.#e.language.dispatchEvent(new Event("change"))))}addListener(e){this.#t.addListener(e)}get language(){return this.#e.language.value}get holder(){return this.#n}};function I(){for(let t of["input","change"])window.addEventListener(t,({target:e})=>{e instanceof HTMLInputElement&&A(e)});for(let t of[...document.querySelectorAll("input[data-max]"),...document.querySelectorAll("input[data-min]")])A(t)}function A(t){t.dataset.min&&G(t,t.dataset.min),t.dataset.max&&D(t,t.dataset.max)}function G(t,e){let n=document.querySelectorAll(`input[data-max="${e}"]`);for(let r of n)if(r.valueAsNumber<t.valueAsNumber){let a=r.value;r.value=t.value,a!==r.value&&N(r)}}function D(t,e){let n=document.querySelectorAll(`input[data-min="${e}"]`);for(let r of n)if(r.valueAsNumber>t.valueAsNumber){let a=r.value;r.value=t.value,a!==r.value&&N(r)}}function N(t){for(let e of["input","change"])t.dispatchEvent(new Event(e,{bubbles:!0}))}function S(){document.body.addEventListener("click",({target:t})=>{if(t instanceof HTMLButtonElement&&t.dataset.inputFor!=null){let e=o(t.dataset.inputFor,HTMLInputElement);e.value=h(t.dataset.inputText??t.textContent),e.dispatchEvent(new Event("input",{bubbles:!0}))}})}function F(){for(let t of["input","change"])window.addEventListener(t,({target:e})=>{if(!(e instanceof HTMLInputElement)||!(e instanceof HTMLTextAreaElement||!(e instanceof HTMLSelectElement)))return;let n=document.querySelectorAll(`output[data-sync-for="${e.id}"]`);for(let r of n)r.value=e.value});for(let t of document.querySelectorAll("output[data-sync-for]")){let e=o(t.dataset.syncFor,HTMLInputElement);t.value=e.value}}var L=class t{url;inputs;udpateListeners=[];constructor(e,n){this.url=e,this.inputs=new Map(Array.from(n).map(r=>[r.element,r])),this.init()}init(){for(let[e,{defaultValue:n}]of this.inputs.entries())this.url.searchParams.has(e.id)&&(W(e,this.url.searchParams.get(e.id)??n),e.dispatchEvent(new Event("input"))),e.addEventListener("input",()=>{this.updateUrl(e,n),this.udpateListeners.forEach(r=>{r(this.url)})})}static create(e,n){return new t(new URL(e.href),Array.from(n).map(r=>({defaultValue:P(r),element:r})))}updateUrl(e,n){let r=P(e);r===n?this.url.searchParams.delete(e.id):this.url.searchParams.set(e.id,r)}addUpdateListener(e){this.udpateListeners.push(e)}};function P(t){switch(t.type){case"checkbox":return t.checked?"t":"";default:return t.value}}function W(t,e){switch(t.type){case"checkbox":t.checked=e==="t";break;default:t.value=e}}function R(){S(),F(),I(),L.create(location,document.querySelectorAll("input")).addUpdateListener(l=>{window.history.replaceState(null,"",l.toString())});let e=new v({prefabFilter:o("prefab-filter",HTMLInputElement),blockFilter:o("block-filter",HTMLInputElement),minTier:o("min-tier",HTMLInputElement),maxTier:o("max-tier",HTMLInputElement),excludes:Array.from(o("prefab-excludes").querySelectorAll("input[type=checkbox]"))},new Worker("worker/prefabs-filter.js"),new E({language:o("label-lang",HTMLSelectElement)},"labels",navigator.languages),async()=>{let[l,$]=await Promise.all([m("prefab-block-counts.json"),m("prefab-difficulties.json")]);return Object.keys(l).map(M=>({name:M,x:0,z:0,difficulty:$[M]??0}))}),n=o("min-tier",HTMLInputElement),r=o("max-tier",HTMLInputElement);o("tier-clear",HTMLButtonElement).addEventListener("click",()=>{n.value=n.defaultValue,r.value=r.defaultValue,n.dispatchEvent(new Event("input")),r.dispatchEvent(new Event("input"))});let s=o("prefabs-status"),i=new f(document.documentElement,o("prefabs-list"),l=>V(l),!0);e.addListener(({update:l})=>{s.textContent=l.status,i.iterator=l.prefabs}),document.addEventListener("scroll",()=>{document.documentElement.dispatchEvent(new Event("scroll"))}),e.init().catch(u)}function V(t){let e=document.createElement("li");if(e.innerHTML=[...t.difficulty?[`<span title="Difficulty Tier ${t.difficulty.toString()}" class="prefab-difficulty-${t.difficulty.toString()}">`,`  \u{1F480}${t.difficulty.toString()}`,"</span>"]:[],`<a href="prefabs/${t.name}.html" target="_blank">`,t.highlightedLabel??"-","/",`<small>${t.highlightedName??t.name}</small></a>`,...t.matchedBlocks&&t.matchedBlocks.length>0?["has",z(t.matchedBlocks),"blocks"]:[]].join(" "),t.matchedBlocks&&t.matchedBlocks.length>0){let n=document.createElement("ul");t.matchedBlocks.forEach(r=>{if(r.count===void 0)return;let a=document.createElement("li");a.innerHTML=[`<button data-input-for="blocks-filter" data-input-text="${r.name}" title="Filter with this block name">\u25B2</button>`,`${r.count.toString()}x`,r.highlightedLabel,`<small>${r.highlightedName}</small>`].join(" "),n.appendChild(a)}),e.appendChild(n)}return e}function z(t){return t.reduce((e,n)=>e+(n.count??0),0)}var v=class{#e;#t;#n;#r;#a=new c;constructor(e,n,r,a){this.#e=e,this.#t=n,this.#n=r,this.#r=a,e.prefabFilter.addEventListener("input",()=>{n.postMessage({prefabFilterRegexp:e.prefabFilter.value})}),e.blockFilter.addEventListener("input",()=>{n.postMessage({blockFilterRegexp:e.blockFilter.value})});let s={start:e.minTier.valueAsNumber,end:e.maxTier.valueAsNumber};e.minTier.addEventListener("input",()=>{let i=e.minTier.valueAsNumber;i!==s.start&&(s.start=i,this.#t.postMessage({difficulty:s}))}),e.maxTier.addEventListener("input",()=>{let i=e.maxTier.valueAsNumber;i!==s.end&&(s.end=i,this.#t.postMessage({difficulty:s}))}),e.excludes.forEach(i=>{i.addEventListener("change",()=>{n.postMessage({preExcludes:this.#s})})}),n.addEventListener("message",i=>{this.#a.dispatchNoAwait(i.data)}),r.addListener(({update:{lang:i}})=>{n.postMessage({language:i})})}get#s(){return this.#e.excludes.flatMap(e=>e.checked?[e.value]:[])}get#i(){return{start:this.#e.minTier.valueAsNumber,end:this.#e.maxTier.valueAsNumber}}addListener(e){this.#a.addListener(e)}async init(){this.#t.postMessage({prefabFilterRegexp:this.#e.prefabFilter.value,blockFilterRegexp:this.#e.blockFilter.value,difficulty:this.#i,preExcludes:this.#s,language:this.#n.language,all:await this.#r()})}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",R):R();})();
//# sourceMappingURL=prefabs.js.map
