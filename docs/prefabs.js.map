{"version":3,"file":"prefabs.js","mappings":"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","sources":["webpack://7dtd-map/./src/lib/delayed-renderer.ts","webpack://7dtd-map/./src/lib/label-handler.ts","webpack://7dtd-map/./src/lib/labels.ts","webpack://7dtd-map/./src/lib/preset-button.ts","webpack://7dtd-map/./src/lib/url-state.ts","webpack://7dtd-map/./src/lib/utils.ts","webpack://7dtd-map/./src/prefabs.ts","webpack://7dtd-map/webpack/bootstrap","webpack://7dtd-map/webpack/startup"],"sourcesContent":["import { requireNonnull, waitAnimationFrame } from \"./utils\";\n\nexport class DelayedRenderer<T> {\n  _iterator: Iterator<T[]> = ([] as T[][])[Symbol.iterator]();\n  appendee: HTMLElement;\n  scrollableWrapper: HTMLElement;\n  itemRenderer: (item: T) => Node;\n  scrollCallback = (): void => {\n    this.renderAll();\n  };\n\n  constructor(scrollableWrapper: HTMLElement, appendee: HTMLElement, itemRenderer: (item: T) => Node) {\n    if (!scrollableWrapper.contains(appendee)) throw Error(\"Wrapper element should contain appendee element\");\n    appendee.innerHTML = \"\";\n    this.appendee = appendee;\n    this.scrollableWrapper = scrollableWrapper;\n    this.itemRenderer = itemRenderer;\n  }\n\n  set iterator(iteratorOrIterable: Iterator<T> | Iterable<T>) {\n    if (\"next\" in iteratorOrIterable) {\n      this._iterator = chunkIterator(iteratorOrIterable);\n    } else {\n      this._iterator = chunkIterator(iteratorOrIterable[Symbol.iterator]());\n    }\n    this.appendee.innerHTML = \"\";\n    this.scrollableWrapper.removeEventListener(\"scroll\", this.scrollCallback);\n\n    // Require a delay because flashing childlen like the above fires \"scroll\" events.\n    requestAnimationFrame(() => {\n      this.scrollableWrapper.removeEventListener(\"scroll\", this.scrollCallback);\n      this.scrollableWrapper.addEventListener(\"scroll\", this.scrollCallback, { once: true });\n      renderUntil(this, () => isFill(this.scrollableWrapper));\n    });\n  }\n\n  async renderAll(): Promise<void> {\n    await renderUntil(this, () => false);\n  }\n}\n\nasync function renderUntil<T>(self: DelayedRenderer<T>, stopPredicate: () => boolean) {\n  while (!stopPredicate()) {\n    const result = self._iterator.next();\n    if (isReturn(result)) break;\n    const df = new DocumentFragment();\n    result.value.forEach((i) => df.appendChild(self.itemRenderer(i)));\n    self.appendee.appendChild(df);\n    await waitAnimationFrame();\n  }\n}\n\nfunction isFill(wrapper: HTMLElement) {\n  return wrapper.offsetHeight + 100 < wrapper.scrollHeight;\n}\n\nfunction chunkIterator<T, TReturn, TNext>(origin: Iterator<T, TReturn, TNext>, chunkSize = 10) {\n  let returnResult: IteratorReturnResult<TReturn> | null = null;\n  const chunkIter: Iterator<T[], TReturn, TNext> = {\n    next(...args: [] | [TNext]): IteratorResult<T[], TReturn> {\n      if (returnResult) return returnResult;\n      const chunk = Array<T>(chunkSize);\n      for (let i = 0; i < chunkSize; i++) {\n        const result = origin.next(...args);\n        if (isReturn(result)) {\n          returnResult = result;\n        } else {\n          chunk[i] = result.value;\n        }\n      }\n      return {\n        done: false,\n        value: chunk,\n      };\n    },\n  };\n  if (\"throw\" in origin) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    chunkIter.throw = (e?: any) => {\n      const r = requireNonnull(origin.throw)(e);\n      if (isReturn(r)) return r;\n      else return { done: r.done, value: [r.value] };\n    };\n  }\n  if (\"return\" in origin) {\n    chunkIter.return = (treturn?: TReturn) => {\n      const r = requireNonnull(origin.return)(treturn);\n      if (isReturn(r)) return r;\n      else return { done: r.done, value: [r.value] };\n    };\n  }\n  return chunkIter;\n}\n\nfunction isReturn<T, TReturn>(r: IteratorResult<T, TReturn>): r is IteratorReturnResult<TReturn> {\n  return Boolean(r.done);\n}\n","import { LANGUAGES, Language, resolveLanguage } from \"./labels\";\n\ninterface Doms {\n  language: HTMLSelectElement;\n}\n\nexport class LabelHandler {\n  private doms: Doms;\n  private listener: ((lang: Language) => void)[] = [];\n\n  constructor(doms: Doms, navigatorLanguages: readonly string[]) {\n    this.doms = doms;\n    this.buildSelectOptions(navigatorLanguages);\n    this.doms.language.addEventListener(\"change\", () => {\n      this.listener.map((fn) => fn(this.doms.language.value as Language));\n    });\n  }\n\n  private buildSelectOptions(navigatorLanguages: readonly string[]) {\n    const existingLangs = new Set(Array.from(this.doms.language.options).map((o) => o.value));\n    for (const lang of LANGUAGES) {\n      if (existingLangs.has(lang)) {\n        continue;\n      }\n      const option = document.createElement(\"option\");\n      option.textContent = lang;\n      this.doms.language.appendChild(option);\n    }\n\n    const browserLang = resolveLanguage(navigatorLanguages);\n    if (this.doms.language.value !== browserLang) {\n      this.doms.language.value = resolveLanguage(navigatorLanguages);\n      requestAnimationFrame(() => this.doms.language.dispatchEvent(new Event(\"change\")));\n    }\n  }\n\n  addListener(fn: (lang: Language) => void) {\n    this.listener.push(fn);\n  }\n}\n","export const LANGUAGES = [\n  \"english\",\n  \"german\",\n  \"spanish\",\n  \"french\",\n  \"italian\",\n  \"japanese\",\n  \"koreana\",\n  \"polish\",\n  \"brazilian\",\n  \"russian\",\n  \"turkish\",\n  \"schinese\",\n  \"tchinese\",\n] as const;\nexport type Language = (typeof LANGUAGES)[number];\n\nconst LANGUAGE_TAGS: { [tag: string]: Language } = {\n  en: \"english\",\n  de: \"german\",\n  es: \"spanish\",\n  fr: \"french\",\n  it: \"italian\",\n  ja: \"japanese\",\n  ko: \"koreana\",\n  pl: \"polish\",\n  pt: \"brazilian\",\n  ru: \"russian\",\n  tr: \"turkish\",\n  \"zh-CN\": \"schinese\",\n  \"zh-TW\": \"tchinese\",\n};\n\nexport class LabelHolder {\n  static DEFAULT_LANGUAGE: Language = \"english\";\n\n  private baseUrl: string;\n  private defaultBlocks: Promise<Map<string, string>>;\n  private defaultPrefabs: Promise<Map<string, string>>;\n\n  #language: Language;\n  #blocks: Promise<Labels>;\n  #prefabs: Promise<Labels>;\n\n  constructor(baseUrl: string, navigatorLanguages: readonly string[]) {\n    this.baseUrl = baseUrl;\n    this.#language = resolveLanguage(navigatorLanguages);\n    this.defaultBlocks = this.fetchLabelMap(LabelHolder.DEFAULT_LANGUAGE, \"blocks.json\");\n    this.defaultPrefabs = this.fetchLabelMap(LabelHolder.DEFAULT_LANGUAGE, \"prefabs.json\");\n    this.#blocks = this.buildLabels(this.defaultBlocks, \"blocks.json\");\n    this.#prefabs = this.buildLabels(this.defaultPrefabs, \"prefabs.json\");\n  }\n\n  get blocks(): Promise<Labels> {\n    return this.#blocks;\n  }\n\n  get prefabs(): Promise<Labels> {\n    return this.#prefabs;\n  }\n\n  set language(lang: Language) {\n    if (lang === this.#language) return;\n    console.log(\"LabelHolder set language: %s -> %s\", this.#language, lang);\n    this.#language = lang;\n    this.#blocks = this.buildLabels(this.defaultBlocks, \"blocks.json\");\n    this.#prefabs = this.buildLabels(this.defaultPrefabs, \"prefabs.json\");\n  }\n\n  async buildLabels(defaultLabels: Promise<Map<string, string>>, fileName: string): Promise<Labels> {\n    return new Labels(await this.fetchLabelMap(this.#language, fileName), await defaultLabels);\n  }\n\n  async fetchLabelMap(language: Language, fileName: string): Promise<Map<string, string>> {\n    return new Map(Object.entries(await fetchJson<Labels>(`${this.baseUrl}/${language}/${fileName}`)));\n  }\n}\n\nexport class Labels {\n  labels: Map<string, string>;\n  defaultLabels: Map<string, string>;\n\n  constructor(labels: Map<string, string>, defaultLabels: Map<string, string>) {\n    this.labels = labels;\n    this.defaultLabels = defaultLabels;\n  }\n\n  get(key: string): string | undefined {\n    return this.labels.get(key) ?? this.defaultLabels.get(key);\n  }\n}\n\nexport function resolveLanguage(languages: readonly string[]): Language {\n  for (const clientTag of languages) {\n    for (const [tag, lang] of Object.entries(LANGUAGE_TAGS)) {\n      if (clientTag.startsWith(tag)) return lang;\n    }\n  }\n  return LabelHolder.DEFAULT_LANGUAGE;\n}\n\nasync function fetchJson<T>(path: string): Promise<T> {\n  return (await fetch(path)).json();\n}\n","import { component, requireNonnull } from \"./utils\";\n\nexport function init(): void {\n  document.body.addEventListener(\"click\", ({ target }) => {\n    if (target instanceof HTMLButtonElement && target.dataset.inputFor != null) {\n      const input = component(target.dataset.inputFor, HTMLInputElement);\n      input.value = requireNonnull(target.dataset.inputText ?? target.textContent);\n      input.dispatchEvent(new Event(\"input\"));\n    }\n  });\n}\n","interface StateElement {\n  defaultValue: string;\n  element: HTMLInputElement;\n}\n\n// Store values of input elements in the URL query string.\nexport class UrlState {\n  private url: URL;\n  private inputs: Map<HTMLInputElement, StateElement>;\n  private udpateListeners: Array<(url: URL) => void> = [];\n\n  private constructor(browserUrl: URL, elements: ArrayLike<StateElement>) {\n    this.url = browserUrl;\n    this.inputs = new Map(Array.from(elements).map((e) => [e.element, e]));\n    this.init();\n  }\n\n  private init() {\n    for (const [input, { defaultValue }] of this.inputs.entries()) {\n      if (this.url.searchParams.has(input.id)) {\n        setValue(input, this.url.searchParams.get(input.id) ?? defaultValue);\n        input.dispatchEvent(new Event(\"input\"));\n      }\n\n      input.addEventListener(\"input\", () => {\n        this.updateUrl(input, defaultValue);\n        this.udpateListeners.forEach((fn) => fn(this.url));\n      });\n    }\n  }\n\n  static create(location: Location, elements: ArrayLike<HTMLInputElement>): UrlState {\n    return new UrlState(\n      new URL(location.href),\n      Array.from(elements).map((e) => ({ defaultValue: getValue(e), element: e }))\n    );\n  }\n\n  private updateUrl(input: HTMLInputElement, defaultValue: string) {\n    const value = getValue(input);\n    if (value === defaultValue) {\n      this.url.searchParams.delete(input.id);\n    } else {\n      this.url.searchParams.set(input.id, value);\n    }\n  }\n\n  addUpdateListener(listener: (url: URL) => void) {\n    this.udpateListeners.push(listener);\n  }\n}\n\nfunction getValue(input: HTMLInputElement): string {\n  switch (input.type) {\n    case \"checkbox\":\n      return input.checked ? \"t\" : \"\";\n    default:\n      return input.value;\n  }\n}\n\nfunction setValue(input: HTMLInputElement, value: string) {\n  switch (input.type) {\n    case \"checkbox\":\n      input.checked = value === \"t\";\n      break;\n    default:\n      input.value = value;\n  }\n}\n","export function requireNonnull<T>(t: T | undefined | null, message = () => `Unexpected state: ${t}`): T {\n  if (t != null) return t;\n  else throw Error(message());\n}\n\nexport function requireType<T>(o: unknown, t: { new (...a: unknown[]): T }, message = () => `Unexpected type: ${o}`): T {\n  if (o instanceof t) return o;\n  throw Error(message());\n}\n\nexport function component<T extends HTMLElement = HTMLElement>(id: string | null | undefined, t?: { new (...a: unknown[]): T }): T {\n  const e = requireNonnull(\n    document.getElementById(requireNonnull(id, () => `Element ID must not null: ${id}`)),\n    () => `Element not found: #${id}`\n  );\n  return t ? requireType(e, t) : (e as T);\n}\n\nexport function removeAllChildren(e: HTMLElement): void {\n  while (e.lastChild) e.removeChild(e.lastChild);\n}\n\nexport function humanreadableDistance(d: number): string {\n  if (d < 1000) {\n    return `${d}m`;\n  }\n  return `${(d / 1000).toFixed(2)}km`;\n}\n\nexport function waitAnimationFrame(): Promise<number> {\n  return new Promise((r) => requestAnimationFrame(r));\n}\n\ninterface EventOffsets {\n  offsetX: number;\n  offsetY: number;\n}\n\nexport function formatCoords(\n  map: GameMapSize,\n  canvas: HTMLCanvasElement,\n  elevation: (coods: GameCoords, mapSize: GameMapSize) => number | null,\n  event: EventOffsets | null\n): string {\n  if (!event) return \"E/W: -, N/S: -, Elev: -\";\n\n  const gameCoords = canvasEventToGameCoords(event, map, canvas);\n  if (gameCoords === null) {\n    return \"E/W: -, N/S: -, Elev: -\";\n  }\n\n  const y = elevation(gameCoords, map) ?? \"-\";\n  return `E/W: ${gameCoords.x}, N/S: ${gameCoords.z}, Elev: ${y}`;\n}\n\nexport function downloadCanvasPng(fileName: string, canvas: HTMLCanvasElement): void {\n  const a = document.createElement(\"a\");\n  a.download = fileName;\n  a.href = canvas.toDataURL(\"image/png\");\n  a.click();\n}\n\nexport async function imageBitmapToPngBlob(img: ImageBitmap): Promise<PngBlob> {\n  const canvas = new OffscreenCanvas(img.height, img.width);\n  const context = requireNonnull(canvas.getContext(\"2d\"));\n  context.drawImage(img, 0, 0);\n  return (await canvas.convertToBlob({ type: \"image/png\" })) as PngBlob;\n}\n\nexport async function sleep(msec: number): Promise<void> {\n  return new Promise((r) => setTimeout(r, msec));\n}\n\nexport function gameMapSize(s: { width: number; height: number }): GameMapSize {\n  return { type: \"game\", ...s };\n}\n\nexport function gameCoords(c: { x: number; z: number }): GameCoords {\n  return { type: \"game\", ...c };\n}\n\n/** Returns null if the event was fired out of the canvas */\nexport function canvasEventToGameCoords(event: EventOffsets, mapSize: GameMapSize, canvasSize: HTMLCanvasElement): GameCoords | null {\n  // in-game scale coords with left-top offset\n  const gx = (event.offsetX * mapSize.width) / canvasSize.width;\n  const gz = (event.offsetY * mapSize.height) / canvasSize.height;\n  if (gx < 0 || gx >= mapSize.width || gz < 0 || gz >= mapSize.height) {\n    return null;\n  }\n\n  // in-game coords (center offset)\n  const x = gx - Math.floor(mapSize.width / 2);\n  const z = Math.floor(mapSize.height / 2) - gz;\n  return gameCoords({ x: Math.round(x), z: Math.round(z) });\n}\n\nexport function threePlaneSize(width: number, height: number): ThreePlaneSize {\n  return { type: \"threePlane\", width, height };\n}\n","import { DelayedRenderer } from \"./lib/delayed-renderer\";\nimport * as presetButton from \"./lib/preset-button\";\nimport { component } from \"./lib/utils\";\nimport { PrefabUpdate } from \"./lib/prefabs\";\nimport * as prefabsFilter from \"./worker/prefabs-filter\";\nimport { Language } from \"./lib/labels\";\nimport { LabelHandler } from \"./lib/label-handler\";\nimport { UrlState } from \"./lib/url-state\";\n\ninterface HighlightedPrefab {\n  name: string;\n  difficulty?: number;\n  highlightedName?: string;\n  highlightedLabel?: string;\n  matchedBlocks?: HighlightedBlock[];\n}\n\nfunction main() {\n  presetButton.init();\n\n  const urlState = UrlState.create(location, document.querySelectorAll(\"input\"));\n  urlState.addUpdateListener((url) => window.history.replaceState(null, \"\", url.toString()));\n\n  const prefabsHandler = new PrefabsHandler(new Worker(\"worker/prefabs-filter.js\"));\n  (async () => {\n    const [index, difficulties] = await Promise.all([\n      fetch(\"prefab-block-index.json\").then((r) => r.json()),\n      fetch(\"prefab-difficulties.json\").then((r) => r.json() as Promise<PrefabDifficulties>),\n    ]);\n    const prefabs = Object.keys(index).map((n) => ({ name: n, x: 0, z: 0, difficulty: difficulties[n] }));\n    prefabsHandler.prefabs = prefabs;\n  })();\n\n  const blocksFilter = component(\"blocks_filter\", HTMLInputElement);\n  prefabsHandler.blockFilter = blocksFilter.value;\n  blocksFilter.addEventListener(\"input\", () => {\n    prefabsHandler.blockFilter = blocksFilter.value;\n  });\n\n  const labelHandler = new LabelHandler({ language: component(\"label_lang\", HTMLSelectElement) }, navigator.languages);\n  labelHandler.addListener(async (lang) => {\n    prefabsHandler.language = lang;\n  });\n\n  const prefabFilterHandler = new PrefabFilterHandler({ devPrefabs: component(\"dev_prefabs\", HTMLInputElement) });\n  prefabFilterHandler.addUpdateListener(() => {\n    prefabsHandler.refresh();\n  });\n\n  const prefabListRenderer = new DelayedRenderer<HighlightedPrefab>(document.body, component(\"prefabs_list\"), (p) => prefabLi(p));\n  prefabsHandler.listeners.push(async (update) => {\n    prefabListRenderer.iterator = update.prefabs.filter(prefabFilterHandler.filter());\n  });\n}\n\nfunction prefabLi(prefab: HighlightedPrefab) {\n  const li = document.createElement(\"li\");\n  li.innerHTML = [\n    prefab.difficulty && prefab.difficulty > 0\n      ? `<span title=\"Difficulty Tier ${prefab.difficulty}\" class=\"prefab_difficulty_${prefab.difficulty}\"><span class=\"prefab_difficulty_icon\">ðŸ’€</span>${prefab.difficulty}</span>`\n      : \"\",\n    `<a href=\"prefabs/${prefab.name}.html\" target=\"_blank\">`,\n    prefab.highlightedLabel || \"-\",\n    \"/\",\n    `<small>${prefab.highlightedName || prefab.name}</small>`,\n    \"</a>\",\n  ].join(\" \");\n  if (prefab.matchedBlocks && prefab.matchedBlocks.length > 0) {\n    const blocksUl = document.createElement(\"ul\");\n    prefab.matchedBlocks.forEach((block) => {\n      const blockLi = document.createElement(\"li\");\n      blockLi.innerHTML = [\n        `<button data-input-for=\"blocks_filter\" data-input-text=\"${block.name}\" title=\"Filter with this block name\">â–²</button>`,\n        `${block.count}x`,\n        block.highlightedLabel,\n        `<small>${block.highlightedName}</small>`,\n      ].join(\" \");\n      blocksUl.appendChild(blockLi);\n    });\n    li.appendChild(blocksUl);\n  }\n  return li;\n}\n\ndeclare class PrefabsFilterWorker extends Worker {\n  postMessage(message: prefabsFilter.InMessage): void;\n}\n\nclass PrefabsHandler {\n  worker: PrefabsFilterWorker;\n  listeners: ((prefabs: PrefabUpdate) => Promise<void>)[] = [];\n\n  constructor(worker: PrefabsFilterWorker) {\n    this.worker = worker;\n    this.worker.addEventListener(\"message\", (event: MessageEvent<PrefabUpdate>) => {\n      this.listeners.map((fn) => fn(event.data));\n    });\n  }\n\n  set prefabs(p: Prefab[]) {\n    this.worker.postMessage({ all: p });\n  }\n\n  set blockFilter(filter: string) {\n    this.worker.postMessage({ blocksFilterString: filter });\n  }\n\n  set language(language: Language) {\n    this.worker.postMessage({ language });\n  }\n\n  refresh() {\n    this.worker.postMessage({});\n  }\n}\n\nclass PrefabFilterHandler {\n  displayDevPrefab = false;\n  updateListener: (() => void)[] = [];\n\n  constructor(doms: { devPrefabs: HTMLInputElement }) {\n    this.displayDevPrefab = doms.devPrefabs.checked;\n    doms.devPrefabs.addEventListener(\"input\", () => {\n      this.displayDevPrefab = doms.devPrefabs.checked;\n      this.updateListener.forEach((fn) => fn());\n    });\n  }\n\n  filter(): (prefab: HighlightedPrefab) => boolean {\n    return (prefab) => {\n      if (!this.displayDevPrefab) {\n        return !/^aaa_/i.test(prefab.name);\n      }\n      return true;\n    };\n  }\n\n  addUpdateListener(fn: () => void) {\n    this.updateListener.push(fn);\n  }\n}\n\nif (document.readyState === \"loading\") {\n  document.addEventListener(\"DOMContentLoaded\", main);\n} else {\n  main();\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(19);\n"],"names":["async","renderUntil","self","stopPredicate","result","_iterator","next","isReturn","df","DocumentFragment","value","forEach","i","appendChild","itemRenderer","appendee","waitAnimationFrame","r","Boolean","done","constructor","scrollableWrapper","Symbol","iterator","scrollCallback","this","renderAll","contains","Error","innerHTML","iteratorOrIterable","origin","chunkSize","returnResult","chunkIter","args","chunk","Array","throw","e","requireNonnull","return","treturn","chunkIterator","removeEventListener","requestAnimationFrame","addEventListener","once","isFill","wrapper","offsetHeight","scrollHeight","doms","navigatorLanguages","listener","buildSelectOptions","language","map","fn","existingLangs","Set","from","options","o","lang","LANGUAGES","has","option","document","createElement","textContent","browserLang","resolveLanguage","dispatchEvent","Event","addListener","push","LANGUAGE_TAGS","en","de","es","fr","it","ja","ko","pl","pt","ru","tr","LabelHolder","baseUrl","defaultBlocks","fetchLabelMap","DEFAULT_LANGUAGE","defaultPrefabs","buildLabels","blocks","prefabs","console","log","defaultLabels","fileName","Labels","Map","Object","entries","path","fetch","json","fetchJson","labels","get","key","languages","clientTag","tag","startsWith","body","target","HTMLButtonElement","dataset","inputFor","input","component","HTMLInputElement","inputText","UrlState","browserUrl","elements","udpateListeners","url","inputs","element","init","defaultValue","searchParams","id","setValue","updateUrl","static","location","URL","href","getValue","delete","set","addUpdateListener","type","checked","t","message","requireType","gameCoords","c","canvasEventToGameCoords","event","mapSize","canvasSize","gx","offsetX","width","gz","offsetY","height","x","Math","floor","z","round","getElementById","lastChild","removeChild","d","toFixed","Promise","canvas","elevation","y","a","download","toDataURL","click","img","OffscreenCanvas","getContext","drawImage","convertToBlob","msec","setTimeout","s","main","presetButton","create","querySelectorAll","window","history","replaceState","toString","prefabsHandler","PrefabsHandler","Worker","index","difficulties","all","then","keys","n","name","difficulty","blocksFilter","blockFilter","LabelHandler","HTMLSelectElement","navigator","prefabFilterHandler","PrefabFilterHandler","devPrefabs","refresh","prefabListRenderer","DelayedRenderer","p","prefab","li","highlightedLabel","highlightedName","join","matchedBlocks","length","blocksUl","block","blockLi","count","prefabLi","listeners","update","filter","worker","data","postMessage","blocksFilterString","displayDevPrefab","updateListener","test","readyState","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","call"],"sourceRoot":""}