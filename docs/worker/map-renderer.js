(()=>{"use strict";var t={407:function(t,e,i){var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=a(i(847)),n="ðŸš©ï¸";function h(t,{text:e,x:i,z:a,size:s}){t.lineWidth=Math.round(.2*s),t.strokeStyle="rgba(0, 0, 0, 0.8)",t.strokeText(e,i,a),t.lineWidth=Math.round(.1*s),t.strokeStyle="white",t.strokeText(e,i,a),t.fillText(e,i,a)}e.default=class{constructor(t,e){this.fontFace=null,this.canvas=t,this.showPrefabs=!0,this.biomesImg=null,this.biomesAlpha=1,this.splat3Img=null,this.splat3Alpha=1,this.splat4Img=null,this.splat4Alpha=1,this.radImg=null,this.radAlpha=1,this.brightness="100%",this.scale=.1,this.signSize=200,this.signAlpha=1,this.prefabs=[],this.fontFace=e,fonts.add(e),this.markerCoords=null,this.throttledUpdater=s.default((()=>this.updateImmediately()))}get width(){return Math.max(this.biomesImg?.width??0,this.splat3Img?.width??0,this.splat4Img?.width??0)}get height(){return Math.max(this.biomesImg?.height??0,this.splat3Img?.height??0,this.splat4Img?.height??0)}async update(){console.time("Map Update"),await this.throttledUpdater(),console.timeEnd("Map Update")}isBlank(){return!this.biomesImg&&!this.splat3Img&&!this.splat4Img}async updateImmediately(){if(this.isBlank())return this.canvas.width=1,void(this.canvas.height=1);this.canvas.width=this.width*this.scale,this.canvas.height=this.height*this.scale;const t=this.canvas.getContext("2d");t&&(t.scale(this.scale,this.scale),t.filter=`brightness(${this.brightness})`,this.biomesImg&&0!==this.biomesAlpha&&(t.globalAlpha=this.biomesAlpha,t.drawImage(this.biomesImg,0,0,this.width,this.height)),this.splat3Img&&0!==this.splat3Alpha&&(t.globalAlpha=this.splat3Alpha,t.drawImage(this.splat3Img,0,0,this.width,this.height)),this.splat4Img&&0!==this.splat4Alpha&&(t.globalAlpha=this.splat4Alpha,t.drawImage(this.splat4Img,0,0,this.width,this.height)),t.filter="none",this.radImg&&0!==this.radAlpha&&(t.globalAlpha=this.radAlpha,t.imageSmoothingEnabled=!1,t.drawImage(this.radImg,0,0,this.width,this.height),t.imageSmoothingEnabled=!0),t.globalAlpha=this.signAlpha,this.showPrefabs&&function(t,e){e.font=`${t.signSize}px ${t.fontFace?.family??""}`,e.fillStyle="red",e.textAlign="center",e.textBaseline="middle";const i=t.width/2,a=t.height/2,s=Math.round(.01*t.signSize),n=Math.round(.05*t.signSize);for(let o=t.prefabs.length-1;o>=0;o-=1){const l=t.prefabs[o];h(e,{text:"âœ˜",x:i+l.x+s,z:a-l.z+n,size:t.signSize})}}(this,t),this.markerCoords&&function(t,e){if(!t.markerCoords)return;e.font=`${t.signSize}px ${t.fontFace?.family??""}`,e.fillStyle="red",e.textAlign="left",e.textBaseline="alphabetic";const i=t.width/2,a=t.height/2,s=-1*Math.round(.32*t.signSize),o=-1*Math.round(.1*t.signSize),l=i+t.markerCoords.x+s,r=a-t.markerCoords.z+o;h(e,{text:n,x:l,z:r,size:t.signSize}),e.strokeText(n,l,r),e.fillText(n,l,r)}(this,t))}}},847:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const a=i(726);e.default=function(t){let e=!1,i=null;return async()=>{e=!0,i||(i=(async()=>{for(;e;)e=!1,await t(),await a.waitAnimationFrame();i=null})())}}},726:(t,e)=>{function i(t,e=(()=>`Unexpected state: ${t}`)){if(t)return t;throw Error(e())}function a(t,e,i=(()=>`Unexpected type: ${t}`)){if(t instanceof e)return t;throw Error(i())}Object.defineProperty(e,"__esModule",{value:!0}),e.downloadCanvasPng=e.formatCoords=e.waitAnimationFrame=e.humanreadableDistance=e.removeAllChildren=e.component=e.requireType=e.requireNonnull=void 0,e.requireNonnull=i,e.requireType=a,e.component=function(t,e){const s=i(document.getElementById(i(t,(()=>`Element ID must not null: ${t}`))),(()=>`Element not found: #${t}`));return e?a(s,e):s},e.removeAllChildren=function(t){for(;t.lastChild;)t.removeChild(t.lastChild)},e.humanreadableDistance=function(t){return t<1e3?`${t}m`:`${(t/1e3).toFixed(2)}km`},e.waitAnimationFrame=function(){return new Promise((t=>requestAnimationFrame(t)))},e.formatCoords=function(t,e,i,a){if(!a)return"E/W: -, N/S: -, Elev: -";const s=a.offsetX*t.width/e.width,n=a.offsetY*t.height/e.height;return s<0||s>=t.width||n<0||n>=t.height?"E/W: -, N/S: -, Elev: -":`E/W: ${Math.round(s-t.width/2)}, N/S: ${Math.round(t.height/2-n)}, Elev: ${i({x:Math.round(s),z:Math.round(n)},t.width)??"-"}`},e.downloadCanvasPng=function(t,e){const i=document.createElement("a");i.download=t,i.href=e.toDataURL("image/png"),i.click()}},179:function(t,e,i){var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=a(i(407)),n=new FontFace("Noto Sans","url(../NotoEmoji-Regular.ttf)").load();let h=null;async function o(t){if(console.debug(t),!h){if(!t.canvas)throw Error("Unexpected state");h=new s.default(t.canvas,await n)}await Object.assign(h,t).update(),postMessage({mapSize:{width:h.width,height:h.height}})}const l=async function*(){for(;;)try{await o(yield)}catch(t){console.error(t)}}();l.next(),onmessage=async t=>await l.next(t.data)}},e={};!function i(a){var s=e[a];if(void 0!==s)return s.exports;var n=e[a]={exports:{}};return t[a].call(n.exports,n,n.exports,i),n.exports}(179)})();
//# sourceMappingURL=map-renderer.js.map